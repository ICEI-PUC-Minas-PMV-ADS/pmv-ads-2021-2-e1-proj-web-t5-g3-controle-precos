<!DOCTYPE html>
<html lang="PT-BR">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"  integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">    
    <link rel="stylesheet" href="style.css">    
    <title> Abasteça Agora </title> 
  </head>

  <body onload="initPostoLocalizado()">
    <header>
      <div>
        <img width="250" height="100" src="imgs/logo.png" alt="Logo"></div>
        <div class="botão"> 
          <a href="a_empresa.html">
            <button type="button" class="btn btn-outline-danger">A Empresa</button>
          </a> 
      <a href="login.html">
          <button type="button" class="btn btn-outline-danger">Login</button> 
        </a>   
      </div>   
    </header>      
      <h1>Encontramos os melhores preços para você !</h1>
    <div class="col-sm-12">            
        <div class="Localidade">                            
            <img src="imgs/mapa_2.jpeg" usemap="#image-map">
                <map name="image-map">
                   <area target="" alt="Posto 1" title="Posto 1" href="javascript:exibeDetalhesPosto(4);" coords="130,100,12" shape="circle">
                   <area target="" alt="Posto 2" title="Posto 2" href="javascript:exibeDetalhesPosto(5);" coords="228,165,13" shape="circle">
                   <area target="" alt="Posto 3" title="Posto 3" href="javascript:exibeDetalhesPosto(6);" coords="309,26,12" shape="circle">
                </map>                                                           
        </div>       
        <br>                       
        <div class="col-sm-12">                                 
            <table id="grid-detalhes-posto-2" class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Nome</th>
                        <th scope="col">Telefone</th>
                        <th scope="col">E-mail</th>                                            
                    </tr>
                </thead>
                <tbody id="table-detalhes-posto-2">
                    <tr>
                      <td scope="row">1</td>
                      <td></td> 
                      <td></td>                                       
                    </tr>                                        
                </tbody>
            </table>                                      
        </div>
        <div class="col-sm-12">
            <table id="grid-detalhes-posto" class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">#</th>                                            
                    </tr>
                </thead>
            
                <tbody id="table-detalhes-posto">
                    <tr>
                    <td scope="row">1</td>
                    <td></td>                                        
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="estrelas" >
            <form name=classificacao>
              <input type="radio" id="cm_star-empty" name="fb" value="" checked/>
              <label for="cm_star-1"><i class="fa"></i></label>
              <input type="radio" id="cm_star-1" name="fb" value="1" />
              <label for="cm_star-2"><i class="fa"></i></label>
              <input type="radio" id="cm_star-2" name="fb" value="2" />
              <label for="cm_star-3"><i class="fa"></i></label>
              <input type="radio" id="cm_star-3" name="fb" value="3" />
              <label for="cm_star-4"><i class="fa"></i></label>
              <input type="radio" id="cm_star-4" name="fb" value="4" />
              <label for="cm_star-5"><i class="fa"></i></label>
              <input type="radio" id="cm_star-5" name="fb" value="5"/>
            </form>
        </div>
    </div>                  
        <div> 
         <p> 
           Você é dono de posto e ainda não faz parte do nosso quadro de fornecedores? <a href="area_fornecedor.html">Clique aqui</a> e se torne um dos nossos fornecedores. <br>
           Se você é um consumidor e quer avaliar os serviços dos postos.<a href="cadastro_consumidores.html">Clique aqui</a> faça já o seu cadastro.
         </p> 
        </div>      
        <footer> <p class="mt-5 mb-3 text-muted">&copy; 2021–2021</p></footer>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script src="app.js"></script>
        <script>
            
            //Exibe detalhes relacionados com cada posto de gasollina
            function exibeDetalhesPosto(idPosto) {
                               
                if(!idPosto || idPosto =='') idPosto = 6;

                //Limpa tabelas
                $("#table-detalhes-posto").html("");                
                $("#table-detalhes-posto-2").html("");

                // Popula a tabela com os registros do banco de dados
                for (i = 0; i < db_table_GasStation_Detail.data.length; i++) {
                    let posto = db_table_GasStation_Detail.data[i];    
                    if(idPosto == posto.idPosto){
                        $("#table-detalhes-posto").append(`<tr><td scope="row">${posto.parametro}</td>
                                                        <td>${posto.valor}</td>                                                    
                                                    </tr>`);
                    }
                }
                
                // Popula a tabela com os registros do banco de dados
                for (i = 0; i < db.data.length; i++) {
                    let contato = db.data[i];                        
                    if(idPosto == contato.id){    
                        $("#table-detalhes-posto-2").append(`<tr><td scope="row">${contato.nome}</td>                                                    
                                                    <td>${contato.telefone}</td>
                                                    <td>${contato.email}</td>
                                                </tr>`);
                    }
                }

                //Calcula nota do posto selecionado
                var notaPosto = 0;
                var totalVotos = 0;
                for (i = 0; i < db_table_GasStationScore.data.length; i++) {                                           
                    let ntPosto = db_table_GasStationScore.data[i];
                    if(ntPosto.idPosto == idPosto){                           
                        notaPosto = notaPosto + ntPosto.nota;                                                                  
                        totalVotos++;
                    }
                }
                
                //Para evitar erro de divisão por zero
                if (db_table_GasStationScore.data.length > 0){
                     notaPosto = Math.round(notaPosto / totalVotos);                         
                }
                
                //Busca radios buttons para marcar
                var radios = document.getElementsByName('fb');                
                for (var j = 1; j <= notaPosto; j++) {                    
                    radios[j].checked = true;                    
                }
            }

            //Inicia página
            function initPostoLocalizado() {                                
                exibeDetalhesPosto(0);                
            }            
        </script>   
  </body>
</html>      